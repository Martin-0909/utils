use std::fs::File;
use std::io::Write;

fn main() -> Result<(), Box<dyn std::error::Error>> {
    // åˆ›å»º 3D ç‚¹æ•°æ®
    let points = vec![
        [0.0, 0.0, 0.0],
        [1.0, 1.0, 1.0],
        [2.0, 0.5, 1.5],
        [-1.0, 2.0, 0.5],
    ];
    
    // åˆ›å»ºç®€å•çš„ JSON æ ¼å¼æ•°æ®
    let mut json_content = String::new();
    json_content.push_str("{\n");
    json_content.push_str("  \"application\": \"Bazel + Rust 3D Points Sample\",\n");
    json_content.push_str("  \"generated_by\": \"Bazel 7.6.1 + rules_rust 0.49.3\",\n");
    json_content.push_str("  \"points_3d\": [\n");
    
    for (i, point) in points.iter().enumerate() {
        json_content.push_str(&format!("    [{}, {}, {}]", point[0], point[1], point[2]));
        if i < points.len() - 1 {
            json_content.push_str(",");
        }
        json_content.push_str("\n");
    }
    
    json_content.push_str("  ],\n");
    json_content.push_str(&format!("  \"count\": {}\n", points.len()));
    json_content.push_str("}\n");
    
    // å†™å…¥ JSON æ–‡ä»¶
    let mut file = File::create("points_3d_data.json")?;
    file.write_all(json_content.as_bytes())?;
    
    // åˆ›å»ºä¸€ä¸ªç®€å•çš„ CSV æ–‡ä»¶
    let mut csv_file = File::create("points_3d_data.csv")?;
    writeln!(csv_file, "x,y,z")?;
    for point in &points {
        writeln!(csv_file, "{},{},{}", point[0], point[1], point[2])?;
    }
    
    // åˆ›å»ºä¸€ä¸ªç®€å•çš„ Python å¯è§†åŒ–è„šæœ¬
    let python_script = r#"#!/usr/bin/env python3
import json
import matplotlib.pyplot as plt
from mpl_toolkits.mplot3d import Axes3D

# è¯»å– JSON æ•°æ®
with open('points_3d_data.json', 'r') as f:
    data = json.load(f)

points = data['points_3d']
x = [p[0] for p in points]
y = [p[1] for p in points]
z = [p[2] for p in points]

# åˆ›å»º 3D æ•£ç‚¹å›¾
fig = plt.figure(figsize=(10, 8))
ax = fig.add_subplot(111, projection='3d')
ax.scatter(x, y, z, c='red', marker='o', s=100)

ax.set_xlabel('X')
ax.set_ylabel('Y')
ax.set_zlabel('Z')
ax.set_title('3D Points Generated by Bazel + Rust')

# æ·»åŠ ç½‘æ ¼
ax.grid(True)

# ä¿å­˜å›¾åƒ
plt.savefig('3d_points_visualization.png', dpi=300, bbox_inches='tight')
print("âœ… 3D visualization saved as '3d_points_visualization.png'")

plt.show()
"#;
    
    let mut py_file = File::create("visualize_points.py")?;
    py_file.write_all(python_script.as_bytes())?;
    
    println!("âœ… 3D points data files generated successfully!");
    println!("ğŸ“Š Generated files:");
    println!("   - points_3d_data.json (è¯¦ç»†çš„ JSON æ ¼å¼)");
    println!("   - points_3d_data.csv  (ç®€å•çš„ CSV æ ¼å¼)");  
    println!("   - visualize_points.py (Python å¯è§†åŒ–è„šæœ¬)");
    println!("ğŸ“ˆ Points count: {}", points.len());
    println!();
    println!("ğŸš€ ä½¿ç”¨æ–¹æ³•:");
    println!("   python3 visualize_points.py  # ç”Ÿæˆ 3D å¯è§†åŒ–å›¾åƒ");
    
    Ok(())
}
